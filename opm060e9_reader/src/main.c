/*
  ******************************************************************************
  * @file   main.c
  * @author Sifli software development team
  ******************************************************************************
*/
/**
 * @attention
 * Copyright (c) 2021 - 2021,  Sifli Technology
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form, except as embedded into a Sifli integrated circuit
 *    in a product or a software update for such product, must reproduce the above
 *    copyright notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * 3. Neither the name of Sifli nor the names of its contributors may be used to endorse
 *    or promote products derived from this software without specific prior written permission.
 *
 * 4. This software, with or without modification, must only be used with a
 *    Sifli integrated circuit.
 *
 * 5. Any software provided in binary form under this license must not be reverse
 *    engineered, decompiled, modified and/or disassembled.
 *
 * THIS SOFTWARE IS PROVIDED BY SIFLI TECHNOLOGY "AS IS" AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY, NONINFRINGEMENT, AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL SIFLI TECHNOLOGY OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */

#include <rtthread.h>
#include <rtdevice.h>
#include <board.h>
#include <string.h>
#include "rtconfig.h"
#include "bf0_hal.h"
#include "drv_io.h"
#include "stdio.h"

#include "bsp_board.h"
#include "bsp_e-ink.h"
#include "elm.h"
// #include "opm060e9_driver.h"
// #include "epd_tps.h"
// #include "epd_pin_defs.h"
#include "window_mng.h"
#include "window_def.h"
#include "button.h"




// // FatFs
// FATFS    fs;                             /* FatFs????????? */
// FIL      fnew;                           /* ??????? */
// FRESULT  res_sd;                         /* ?????????? */
// UINT     fnum;                           /* ?????????????? */
// BYTE     ReadBuffer[4096]={0};           /* ???????? */

// W25Q128
__IO uint32_t DeviceID = 0;
__IO uint32_t FlashID = 0;

// EPD ????



// ??


uint32_t   Page_Counter_EN_CH_Space = 0; // ????????????????

// ??????????
uint8_t   Font_Control = SongTi;     // ???????
uint8_t   Fsize_Control = 24;        // ???????????
uint8_t   H_Space_Control = 10;      // ?????
uint8_t   Z_Space_Control = 0;       // ????

#if 0
const uint8_t ReadBuffer[] =
{
    0xD4, 0xDA, 0xBD, 0xF1, 0xCC, 0xEC, 0xB5, 0xC4, 0xC9, 0xE7, 0xBB, 0xE1,
    0xA3, 0xAC, 0x74, 0x65, 0x63, 0x68, 0x6E, 0x6F, 0x6C, 0x6F, 0x67, 0x79,
    0x20, 0x70, 0x6C, 0x61, 0x79, 0x73, 0x20, 0x61, 0x20, 0x63, 0x72, 0x75,
    0x63, 0x69, 0x61, 0x6C, 0x20, 0x72, 0x6F, 0x6C, 0x65, 0x20, 0x69, 0x6E,
    0x20, 0x73, 0x68, 0x61, 0x70, 0x69, 0x6E, 0x67, 0x20, 0x6F, 0x75, 0x72,
    0x20, 0x6C, 0x69, 0x76, 0x65, 0x73, 0x2E, 0x20, 0xCE, 0xDE, 0xC2, 0xDB,
    0xCA, 0xC7, 0xD4, 0xDA, 0xB9, 0xA4, 0xD7, 0xF7, 0xA1, 0xA2, 0xD1, 0xA7,
    0xCF, 0xB0, 0xBB, 0xB9, 0xCA, 0xC7, 0xC8, 0xD5, 0xB3, 0xA3, 0xC9, 0xFA,
    0xBB, 0xEE, 0xD6, 0xD0, 0xA3, 0xAC, 0xCE, 0xD2, 0xC3, 0xC7, 0xB6, 0xBC,
    0xC0, 0xEB, 0xB2, 0xBB, 0xBF, 0xAA, 0xB8, 0xF7, 0xD6, 0xD6, 0xBF, 0xC6,
    0xBC, 0xBC, 0xB5, 0xC4, 0xD6, 0xA7, 0xB3, 0xD6, 0xA1, 0xA3, 0x46, 0x6F,
    0x72, 0x20, 0x65, 0x78, 0x61, 0x6D, 0x70, 0x6C, 0x65, 0x2C, 0x20, 0x73,
    0x6D, 0x61, 0x72, 0x74, 0x70, 0x68, 0x6F, 0x6E, 0x65, 0x73, 0x2C, 0x20,
    0x63, 0x6F, 0x6D, 0x70, 0x75, 0x74, 0x65, 0x72, 0x73, 0x2C, 0x20, 0x61,
    0x6E, 0x64, 0x20, 0x74, 0x68, 0x65, 0x20, 0x69, 0x6E, 0x74, 0x65, 0x72,
    0x6E, 0x65, 0x74, 0x20, 0x68, 0x61, 0x76, 0x65, 0x20, 0x72, 0x65, 0x76,
    0x6F, 0x6C, 0x75, 0x74, 0x69, 0x6F, 0x6E, 0x69, 0x7A, 0x65, 0x64, 0x20,
    0x74, 0x68, 0x65, 0x20, 0x77, 0x61, 0x79, 0x20, 0x77, 0x65, 0x20, 0x63,
    0x6F, 0x6D, 0x6D, 0x75, 0x6E, 0x69, 0x63, 0x61, 0x74, 0x65, 0x2C, 0x20,
    0x77, 0x6F, 0x72, 0x6B, 0x2C, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x6C, 0x65,
    0x61, 0x72, 0x6E, 0x2E, 0x20, 0xD2, 0xD4, 0xC7, 0xB0, 0xCE, 0xD2, 0xC3,
    0xC7, 0xD2, 0xAA, 0xCD, 0xA8, 0xB9, 0xFD, 0xD3, 0xCA, 0xBC, 0xC4, 0xD0,
    0xC5, 0xBC, 0xFE, 0xBB, 0xF2, 0xB4, 0xF2, 0xB5, 0xE7, 0xBB, 0xB0, 0xB2,
    0xC5, 0xC4, 0xDC, 0xD3, 0xEB, 0xD4, 0xB6, 0xD4, 0xDA, 0xC7, 0xA7, 0xC0,
    0xEF, 0xD6, 0xAE, 0xCD, 0xE2, 0xB5, 0xC4, 0xC8, 0xCB, 0xB1, 0xA3, 0xB3,
    0xD6, 0xC1, 0xAA, 0xCF, 0xB5, 0xA3, 0xAC, 0xB6, 0xF8, 0xCF, 0xD6, 0xD4,
    0xDA, 0xA3, 0xAC, 0xD6, 0xBB, 0xD0, 0xE8, 0xD2, 0xAA, 0xCD, 0xA8, 0xB9,
    0xFD, 0xCA, 0xD6, 0xBB, 0xFA, 0xBB, 0xF2, 0xB5, 0xE7, 0xD7, 0xD3, 0xD3,
    0xCA, 0xBC, 0xFE, 0xBE, 0xCD, 0xBF, 0xC9, 0xD2, 0xD4, 0xBC, 0xB4, 0xCA,
    0xB1, 0xB9, 0xB5, 0xCD, 0xA8, 0xA1, 0xA3, 0x0D, 0x0A, 0x0D, 0x0A, 0xB4,
    0xCB, 0xCD, 0xE2, 0xA3, 0xAC, 0xC8, 0xCB, 0xB9, 0xA4, 0xD6, 0xC7, 0xC4,
    0xDC, 0xB5, 0xC4, 0xB7, 0xA2, 0xD5, 0xB9, 0xC8, 0xC3, 0xD0, 0xED, 0xB6,
    0xE0, 0xB9, 0xA4, 0xD7, 0xF7, 0xB1, 0xE4, 0xB5, 0xC3, 0xB8, 0xFC, 0xBC,
    0xD3, 0xB8, 0xDF, 0xD0, 0xA7, 0xA1, 0xA3, 0x41, 0x49, 0x20, 0x73, 0x79,
    0x73, 0x74, 0x65, 0x6D, 0x73, 0x2C, 0x20, 0x73, 0x75, 0x63, 0x68, 0x20,
    0x61, 0x73, 0x20, 0x63, 0x68, 0x61, 0x74, 0x62, 0x6F, 0x74, 0x73, 0x20,
    0x61, 0x6E, 0x64, 0x20, 0x72, 0x65, 0x63, 0x6F, 0x6D, 0x6D, 0x65, 0x6E,
    0x64, 0x61, 0x74, 0x69, 0x6F, 0x6E, 0x20, 0x61, 0x6C, 0x67, 0x6F, 0x72,
    0x69, 0x74, 0x68, 0x6D, 0x73, 0x2C, 0x20, 0x68, 0x61, 0x76, 0x65, 0x20,
    0x6D, 0x61, 0x64, 0x65, 0x20, 0x73, 0x69, 0x67, 0x6E, 0x69, 0x66, 0x69,
    0x63, 0x61, 0x6E, 0x74, 0x20, 0x69, 0x6D, 0x70, 0x72, 0x6F, 0x76, 0x65,
    0x6D, 0x65, 0x6E, 0x74, 0x73, 0x20, 0x69, 0x6E, 0x20, 0x63, 0x75, 0x73,
    0x74, 0x6F, 0x6D, 0x65, 0x72, 0x20, 0x73, 0x65, 0x72, 0x76, 0x69, 0x63,
    0x65, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x70, 0x65, 0x72, 0x73, 0x6F, 0x6E,
    0x61, 0x6C, 0x69, 0x7A, 0x65, 0x64, 0x20, 0x65, 0x78, 0x70, 0x65, 0x72,
    0x69, 0x65, 0x6E, 0x63, 0x65, 0x73, 0x2E, 0x20, 0xB1, 0xC8, 0xC8, 0xE7,
    0xA3, 0xAC, 0xCE, 0xD2, 0xC3, 0xC7, 0xCD, 0xA8, 0xB9, 0xFD, 0x4E, 0x65,
    0x74, 0x66, 0x6C, 0x69, 0x78, 0xBB, 0xF2, 0x59, 0x6F, 0x75, 0x54, 0x75,
    0x62, 0x65, 0xBF, 0xB4, 0xB5, 0xBD, 0xB5, 0xC4, 0xCD, 0xC6, 0xBC, 0xF6,
    0xC4, 0xDA, 0xC8, 0xDD, 0xA3, 0xAC, 0xC6, 0xE4, 0xB1, 0xB3, 0xBA, 0xF3,
    0xBE, 0xCD, 0xCA, 0xC7, 0xB8, 0xB4, 0xD4, 0xD3, 0xB5, 0xC4, 0x41, 0x49,
    0xC4, 0xA3, 0xD0, 0xCD, 0xD4, 0xDA, 0xB9, 0xA4, 0xD7, 0xF7, 0xA1, 0xA3,
    0x49, 0x74, 0x20, 0x70, 0x72, 0x65, 0x64, 0x69, 0x63, 0x74, 0x73, 0x20,
    0x77, 0x68, 0x61, 0x74, 0x20, 0x77, 0x65, 0x20, 0x6D, 0x69, 0x67, 0x68,
    0x74, 0x20, 0x6C, 0x69, 0x6B, 0x65, 0x20, 0x62, 0x61, 0x73, 0x65, 0x64,
    0x20, 0x6F, 0x6E, 0x20, 0x6F, 0x75, 0x72, 0x20, 0x76, 0x69, 0x65, 0x77,
    0x69, 0x6E, 0x67, 0x20, 0x68, 0x69, 0x73, 0x74, 0x6F, 0x72, 0x79, 0x2C,
    0x20, 0x6D, 0x61, 0x6B, 0x69, 0x6E, 0x67, 0x20, 0x6F, 0x75, 0x72, 0x20,
    0x65, 0x78, 0x70, 0x65, 0x72, 0x69, 0x65, 0x6E, 0x63, 0x65, 0x20, 0x6D,
    0x6F, 0x72, 0x65, 0x20, 0x74, 0x61, 0x69, 0x6C, 0x6F, 0x72, 0x65, 0x64,
    0x20, 0x61, 0x6E, 0x64, 0x20, 0x65, 0x6E, 0x6A, 0x6F, 0x79, 0x61, 0x62,
    0x6C, 0x65, 0x2E, 0x0D, 0x0A, 0x0D, 0x0A, 0xC8, 0xBB, 0xB6, 0xF8, 0xA3,
    0xAC, 0xBE, 0xA1, 0xB9, 0xDC, 0xBF, 0xC6, 0xBC, 0xBC, 0xB4, 0xF8, 0xC0,
    0xB4, 0xC1, 0xCB, 0xD0, 0xED, 0xB6, 0xE0, 0xB1, 0xE3, 0xC0, 0xFB, 0xA3,
    0xAC, 0xCB, 0xFC, 0xD2, 0xB2, 0xB4, 0xF8, 0xC0, 0xB4, 0xC1, 0xCB, 0xD2,
    0xBB, 0xD0, 0xA9, 0xCC, 0xF4, 0xD5, 0xBD, 0xA1, 0xA3, 0x57, 0x69, 0x74,
    0x68, 0x20, 0x74, 0x68, 0x65, 0x20, 0x72, 0x69, 0x73, 0x65, 0x20, 0x6F,
    0x66, 0x20, 0x73, 0x6F, 0x63, 0x69, 0x61, 0x6C, 0x20, 0x6D, 0x65, 0x64,
    0x69, 0x61, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x63, 0x6F, 0x6E, 0x73, 0x74,
    0x61, 0x6E, 0x74, 0x20, 0x63, 0x6F, 0x6E, 0x6E, 0x65, 0x63, 0x74, 0x69,
    0x76, 0x69, 0x74, 0x79, 0x2C, 0x20, 0x6D, 0x61, 0x6E, 0x79, 0x20, 0x70,
    0x65, 0x6F, 0x70, 0x6C, 0x65, 0x20, 0x6E, 0x6F, 0x77, 0x20, 0x66, 0x65,
    0x65, 0x6C, 0x20, 0x6F, 0x76, 0x65, 0x72, 0x77, 0x68, 0x65, 0x6C, 0x6D,
    0x65, 0x64, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x73, 0x74, 0x72, 0x65, 0x73,
    0x73, 0x65, 0x64, 0x2E, 0x20, 0xD0, 0xC5, 0xCF, 0xA2, 0xB9, 0xFD, 0xD4,
    0xD8, 0xB3, 0xC9, 0xCE, 0xAA, 0xCF, 0xD6, 0xB4, 0xFA, 0xC9, 0xE7, 0xBB,
    0xE1, 0xD6, 0xD0, 0xB5, 0xC4, 0xD2, 0xBB, 0xD6, 0xD6, 0xC6, 0xD5, 0xB1,
    0xE9, 0xCF, 0xD6, 0xCF, 0xF3, 0xA1, 0xA3, 0x54, 0x68, 0x65, 0x20, 0x70,
    0x72, 0x65, 0x73, 0x73, 0x75, 0x72, 0x65, 0x20, 0x74, 0x6F, 0x20, 0x73,
    0x74, 0x61, 0x79, 0x20, 0x63, 0x6F, 0x6E, 0x6E, 0x65, 0x63, 0x74, 0x65,
    0x64, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x75, 0x70, 0x64, 0x61, 0x74, 0x65,
    0x64, 0x20, 0x6F, 0x6E, 0x20, 0x73, 0x6F, 0x63, 0x69, 0x61, 0x6C, 0x20,
    0x6D, 0x65, 0x64, 0x69, 0x61, 0x20, 0x63, 0x61, 0x6E, 0x20, 0x73, 0x6F,
    0x6D, 0x65, 0x74, 0x69, 0x6D, 0x65, 0x73, 0x20, 0x61, 0x66, 0x66, 0x65,
    0x63, 0x74, 0x20, 0x6D, 0x65, 0x6E, 0x74, 0x61, 0x6C, 0x20, 0x68, 0x65,
    0x61, 0x6C, 0x74, 0x68, 0x2E, 0x20, 0xCB, 0xF9, 0xD2, 0xD4, 0xA3, 0xAC,
    0xD4, 0xDA, 0xCF, 0xED, 0xCA, 0xDC, 0xBF, 0xC6, 0xBC, 0xBC, 0xB4, 0xF8,
    0xC0, 0xB4, 0xB5, 0xC4, 0xB1, 0xE3, 0xC0, 0xFB, 0xB5, 0xC4, 0xCD, 0xAC,
    0xCA, 0xB1, 0xA3, 0xAC, 0xCE, 0xD2, 0xC3, 0xC7, 0xD2, 0xB2, 0xD0, 0xE8,
    0xD2, 0xAA, 0xD1, 0xA7, 0xBB, 0xE1, 0xC8, 0xE7, 0xBA, 0xCE, 0xB8, 0xFC,
    0xBA, 0xC3, 0xB5, 0xD8, 0xB9, 0xDC, 0xC0, 0xED, 0xD7, 0xD4, 0xBC, 0xBA,
    0xB5, 0xC4, 0xCA, 0xB1, 0xBC, 0xE4, 0xBA, 0xCD, 0xC7, 0xE9, 0xD0, 0xF7,
    0xA3, 0xAC, 0xD2, 0xD4, 0xB1, 0xE3, 0xB8, 0xFC, 0xBA, 0xC3, 0xB5, 0xD8,
    0xD3, 0xA6, 0xB6, 0xD4, 0xD5, 0xE2, 0xD0, 0xA9, 0xCC, 0xF4, 0xD5, 0xBD,
    0xA1, 0xA3, 0x0D, 0x0A, 0x0D, 0x0A, 0x49, 0x6E, 0x20, 0x63, 0x6F, 0x6E,
    0x63, 0x6C, 0x75, 0x73, 0x69, 0x6F, 0x6E, 0x2C, 0x20, 0x77, 0x68, 0x69,
    0x6C, 0x65, 0x20, 0x74, 0x65, 0x63, 0x68, 0x6E, 0x6F, 0x6C, 0x6F, 0x67,
    0x79, 0x20, 0x68, 0x61, 0x73, 0x20, 0x75, 0x6E, 0x64, 0x6F, 0x75, 0x62,
    0x74, 0x65, 0x64, 0x6C, 0x79, 0x20, 0x6D, 0x61, 0x64, 0x65, 0x20, 0x6F,
    0x75, 0x72, 0x20, 0x6C, 0x69, 0x76, 0x65, 0x73, 0x20, 0x6D, 0x6F, 0x72,
    0x65, 0x20, 0x63, 0x6F, 0x6E, 0x76, 0x65, 0x6E, 0x69, 0x65, 0x6E, 0x74,
    0x20, 0x61, 0x6E, 0x64, 0x20, 0x65, 0x66, 0x66, 0x69, 0x63, 0x69, 0x65,
    0x6E, 0x74, 0x2C, 0x20, 0x69, 0x74, 0x20, 0x69, 0x73, 0x20, 0x69, 0x6D,
    0x70, 0x6F, 0x72, 0x74, 0x61, 0x6E, 0x74, 0x20, 0x74, 0x6F, 0x20, 0x73,
    0x74, 0x72, 0x69, 0x6B, 0x65, 0x20, 0x61, 0x20, 0x62, 0x61, 0x6C, 0x61,
    0x6E, 0x63, 0x65, 0x20, 0x62, 0x65, 0x74, 0x77, 0x65, 0x65, 0x6E, 0x20,
    0x74, 0x68, 0x65, 0x20, 0x64, 0x69, 0x67, 0x69, 0x74, 0x61, 0x6C, 0x20,
    0x77, 0x6F, 0x72, 0x6C, 0x64, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x72, 0x65,
    0x61, 0x6C, 0x2D, 0x6C, 0x69, 0x66, 0x65, 0x20, 0x69, 0x6E, 0x74, 0x65,
    0x72, 0x61, 0x63, 0x74, 0x69, 0x6F, 0x6E, 0x73, 0x2E, 0x20, 0xD6, 0xBB,
    0xD3, 0xD0, 0xD5, 0xE2, 0xD1, 0xF9, 0xA3, 0xAC, 0xCE, 0xD2, 0xC3, 0xC7,
    0xB2, 0xC5, 0xC4, 0xDC, 0xD5, 0xE6, 0xD5, 0xFD, 0xCF, 0xED, 0xCA, 0xDC,
    0xB5, 0xBD, 0xBF, 0xC6, 0xBC, 0xBC, 0xB4, 0xF8, 0xC0, 0xB4, 0xB5, 0xC4,
    0xD2, 0xE6, 0xB4, 0xA6, 0xA3, 0xAC, 0xCD, 0xAC, 0xCA, 0xB1, 0xB1, 0xDC,
    0xC3, 0xE2, 0xC6, 0xE4, 0xBF, 0xC9, 0xC4, 0xDC, 0xB4, 0xF8, 0xC0, 0xB4,
    0xB5, 0xC4, 0xB8, 0xBA, 0xC3, 0xE6, 0xD3, 0xB0, 0xCF, 0xEC, 0xA1, 0xA3
};

#endif

// void HAL_PostMspInit(void)
// {
//     //edp gpio pin
//     const uint32_t pin_out[] =
//     {
//         TPS_WAKEUP,
//         TPS_PWRCOM,
//         TPS_PWRUP,
//         EPD_LE,
//         EPD_OE,
//         EPD_STV,
//         EPD_CPV,
//         EPD_GMODE,
// #ifdef EPD_DRIVER_SOFTWARE
//         EPD_CLK,
//         EPD_SPH,
//         EPD_D0,
//         EPD_D1,
//         EPD_D2,
//         EPD_D3,
//         EPD_D4,
//         EPD_D5,
//         EPD_D6,
//         EPD_D7,
// #endif /*EPD_DRIVER_SOFTWARE*/
//     };
//     int pin_num = sizeof(pin_out) / sizeof(pin_out[0]);

//     //epd pin init
//     for (int i = 0; i < pin_num; i++)
//     {
//         HAL_PIN_Set(PAD_PA00 + pin_out[i], GPIO_A0 + pin_out[i], PIN_NOPULL, 1);
//     }

//     HAL_RCC_EnableModule(RCC_MOD_GPIO1); // GPIO clock enable
//     GPIO_InitTypeDef GPIO_InitStruct;

//     for (int i = 0; i < pin_num; i++)
//     {
//         GPIO_InitStruct.Pin = pin_out[i];
//         GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT;
//         GPIO_InitStruct.Pull = GPIO_PULLDOWN;
//         HAL_GPIO_Init(hwp_gpio1, &GPIO_InitStruct);
//         HAL_GPIO_WritePin(hwp_gpio1, pin_out[i], GPIO_PIN_RESET);
//     }

// #ifdef EPD_DRIVER_LCDC
//     HAL_PIN_Set(PAD_PA00 + EPD_CLK, LCDC1_8080_WR, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_SPH, LCDC1_8080_DC, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D0,  LCDC1_8080_DIO0, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D1,  LCDC1_8080_DIO1, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D2,  LCDC1_8080_DIO2, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D3,  LCDC1_8080_DIO3, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D4,  LCDC1_8080_DIO4, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D5,  LCDC1_8080_DIO5, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D6,  LCDC1_8080_DIO6, PIN_NOPULL, 1);
//     HAL_PIN_Set(PAD_PA00 + EPD_D7,  LCDC1_8080_DIO7, PIN_NOPULL, 1);
// #endif /*EPD_DRIVER_LCDC*/

//     HAL_PIN_Set(PAD_PA00 + TPS_SCL, I2C2_SCL, PIN_PULLUP, 1); // i2c io select
//     HAL_PIN_Set(PAD_PA00 + TPS_SDA, I2C2_SDA, PIN_PULLUP, 1);

//     // key init
//     HAL_PIN_Set(PAD_PA00 + EPD_KEY, GPIO_A0 + EPD_KEY, PIN_PULLDOWN, 1);
// }


static void button_event_handler(int32_t pin, button_action_t action)
{
    wnd_evt_btn_t evt_btn;
    wnd_evt_t *evt;

    evt_btn.pin = pin;
    evt_btn.action = action;

    rt_kprintf("%s, %d, key=%d, action=%d\r\n", __FILE__, __LINE__, evt_btn.pin, evt_btn.action);
    evt = window_create_evt(WINDOW_EVT_BUTTON, &evt_btn, sizeof(evt_btn));
    RT_ASSERT(evt);

    window_send_evt(evt);
}


static void reader_button_init(void)
{
    int32_t id;
    button_cfg_t cfg;

    cfg.pin = BSP_KEY1_PIN;
    cfg.active_state = BUTTON_ACTIVE_HIGH;
    cfg.mode = PIN_MODE_INPUT;
    cfg.button_handler = button_event_handler;
    id = button_init(&cfg);
    RT_ASSERT(id >= 0);
    if (SF_EOK != button_enable(id))
    {
        RT_ASSERT(0);
    }

    cfg.pin = BSP_KEY2_PIN;
    cfg.active_state = BUTTON_ACTIVE_HIGH;
    cfg.mode = PIN_MODE_INPUT;
    cfg.button_handler = button_event_handler;
    id = button_init(&cfg);
    RT_ASSERT(id >= 0);
    if (SF_EOK != button_enable(id))
    {
        RT_ASSERT(0);
    }

    rt_kprintf("key1=%d, key2=%d \r\n", BSP_KEY1_PIN, BSP_KEY2_PIN);
}

int main(void)
{
    uint8_t configbuff[4] = {0};
    uint8_t key, script;
    uint16_t temp;

    // oedtps_init();
    // epd_Init();

    reader_button_init();

    Display_up_handle(false);

#if 0
    // BSP_DispPage_EPD( 0, 0, Fsize_Control, Font_Control, Z_Space_Control, H_Space_Control); // ?????????
    // Paint_SelectImage(BlackImage); // ???????????
    SSD1677_Display_Page(16, 32, Fsize_Control, Font_Control, Z_Space_Control, H_Space_Control, (char *)ReadBuffer);     //??????????

    epd_display_pic(BlackImage);

#endif

    window_mng_init();

    dir_wnd_init();
    setting_wnd_init();
    reader_wnd_init();

    window_load(DIR_WND_ID, NULL);

    window_loop();
}